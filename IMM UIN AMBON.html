<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>"IMM UIN AMSA"</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-animation {
            animation: successPulse 0.8s ease-out;
        }

        @keyframes successPulse {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .id-card {
            width: 350px;
            height: 220px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .id-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .print-area {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        @media print {
            body * {
                visibility: hidden;
            }

            .print-area,
            .print-area * {
                visibility: visible;
            }

            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                padding: 0;
            }

            .no-print {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <!-- Header -->
        <header class="gradient-bg shadow-2xl">
            <div class="container mx-auto px-4 py-8">
                <div class="text-center mb-8">


                    <h1 class="text-4xl font-bold text-white mb-3 drop-shadow-lg">
                        Pendaftaran calon Baru
                    </h1>
                    <p class="text-xl text-white opacity-90 mb-8">IMM (Ikatan Mahasiswa Muhammadiyah)</p>
                </div>

                <!-- Navigation -->
                <nav class="flex justify-center space-x-4 flex-wrap">
                    <button onclick="showPage('registration')" id="regBtn"
                        class="px-6 py-3 bg-white text-purple-700 rounded-full hover:bg-gray-100 transition-all duration-300 font-semibold shadow-lg mb-2">
                        üìù Pendaftaran
                    </button>
                    <button onclick="showPage('print-card')" id="printBtn"
                        class="px-6 py-3 bg-purple-800 text-white rounded-full hover:bg-purple-900 transition-all duration-300 font-semibold shadow-lg mb-2">
                        üé´ Cetak Kartu
                    </button>
                    <button onclick="showPage('admin-login')" id="adminBtn"
                        class="px-6 py-3 bg-purple-800 text-white rounded-full hover:bg-purple-900 transition-all duration-300 font-semibold shadow-lg mb-2">
                        üë§ Admin
                    </button>
                </nav>
            </div>
        </header>

        <!-- Registration Page -->
        <div id="registration-page" class="container mx-auto px-4 py-8">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-2xl shadow-2xl p-8 card-hover fade-in">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Form Pendaftaran Anggota</h2>

                    <form id="registrationForm" class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="nama" class="block text-sm font-medium text-gray-700 mb-2">Nama
                                    Lengkap</label>
                                <input type="text" id="nama" name="nama" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                            </div>
                            <div>
                                <label for="nim" class="block text-sm font-medium text-gray-700 mb-2">NIM</label>
                                <input type="text" id="nim" name="nim" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="fakultas"
                                    class="block text-sm font-medium text-gray-700 mb-2">Fakultas</label>
                                <select id="fakultas" name="fakultas" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                    <option value="">Pilih Fakultas</option>
                                    <option value="Teknik">Fakultas Teknik</option>
                                    <option value="Ekonomi">Fakultas Ekonomi dan Bisnis</option>
                                    <option value="Hukum">Fakultas Hukum</option>
                                    <option value="FKIP">Fakultas Keguruan dan Ilmu Pendidikan</option>
                                    <option value="Kedokteran">Fakultas Kedokteran</option>
                                    <option value="Pertanian">Fakultas Pertanian</option>
                                </select>
                            </div>
                            <div>
                                <label for="prodi" class="block text-sm font-medium text-gray-700 mb-2">Program
                                    Studi</label>
                                <input type="text" id="prodi" name="prodi" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label for="angkatan"
                                    class="block text-sm font-medium text-gray-700 mb-2">Angkatan</label>
                                <input type="number" id="angkatan" name="angkatan" required min="2020" max="2030"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="email" name="email" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                            </div>
                        </div>

                        <div>
                            <label for="telepon" class="block text-sm font-medium text-gray-700 mb-2">Nomor
                                Telepon</label>
                            <input type="tel" id="telepon" name="telepon" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                        </div>

                        <div>
                            <label for="alamat" class="block text-sm font-medium text-gray-700 mb-2">Alamat</label>
                            <textarea id="alamat" name="alamat" required rows="3"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300"></textarea>
                        </div>



                        <div>
                            <label for="foto" class="block text-sm font-medium text-gray-700 mb-2">Foto untuk Kartu
                                Peserta</label>
                            <div class="flex items-center space-x-4">
                                <div id="photoPreview"
                                    class="w-24 h-32 bg-gray-200 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden">
                                    <svg width="40" height="40" fill="gray" viewBox="0 0 24 24">
                                        <path
                                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <input type="file" id="foto" name="foto" accept="image/*"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                                    <p class="text-sm text-gray-500 mt-1">Format: JPG, PNG (Max: 2MB)</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label for="motivasi" class="block text-sm font-medium text-gray-700 mb-2">Motivasi
                                Bergabung</label>
                            <textarea id="motivasi" name="motivasi" required rows="4"
                                placeholder="Ceritakan motivasi Anda bergabung dengan IMM..."
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300"></textarea>
                        </div>

                        <button type="submit"
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 px-8 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-300 font-semibold text-lg shadow-lg transform hover:scale-105">
                            üöÄ Daftar Sekarang
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Login Page -->
        <div id="admin-login-page" class="container mx-auto px-4 py-8 hidden">
            <div class="max-w-md mx-auto">
                <div class="bg-white rounded-2xl shadow-2xl p-8 card-hover fade-in">
                    <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Login Admin</h2>

                    <form id="adminLoginForm" class="space-y-6">
                        <div>
                            <label for="adminUsername"
                                class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="adminUsername" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                        </div>
                        <div>
                            <label for="adminPassword"
                                class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <input type="password" id="adminPassword" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300">
                        </div>
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-300 font-semibold">
                            üîê Masuk
                        </button>
                    </form>

                    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm text-blue-700">
                            <strong>Demo Login:</strong><br>
                            Username: admin<br>
                            Password: imm2024
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Card Page -->
        <div id="print-card-page" class="container mx-auto px-4 py-8 hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-2xl shadow-2xl p-8 card-hover fade-in">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800">üé´ Cetak Kartu Peserta</h2>
                        <button onclick="showPage('registration')"
                            class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-all duration-300">
                            ‚Üê Kembali
                        </button>
                    </div>

                    <!-- Search Member -->
                    <div class="mb-8">
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="md:col-span-2">
                                <label for="searchMember" class="block text-sm font-medium text-gray-700 mb-2">Cari
                                    Anggota (berdasarkan Nama atau NIM)</label>
                                <input type="text" id="searchMember" placeholder="Masukkan nama atau NIM anggota..."
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div class="flex items-end">
                                <button onclick="searchForPrint()"
                                    class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-all duration-300">
                                    üîç Cari
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="searchResults" class="mb-8 hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Hasil Pencarian</h3>
                        <div id="membersList" class="space-y-4">
                            <!-- Results will be populated here -->
                        </div>
                    </div>

                    <!-- Card Preview -->
                    <div id="cardPreview" class="hidden">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">Preview Kartu Peserta</h3>

                        <div class="flex justify-center mb-8">
                            <div class="print-area">
                                <div id="memberCard" class="id-card mx-auto relative">
                                    <!-- Card content will be populated here -->
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center space-x-4">
                            <button onclick="printCard()"
                                class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-all duration-300 font-semibold">
                                üñ®Ô∏è Cetak Kartu
                            </button>
                            <button onclick="downloadCardPDF()"
                                class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-all duration-300 font-semibold">
                                üì• Download PDF
                            </button>
                        </div>
                    </div>

                    <!-- No Results Message -->
                    <div id="noResults" class="text-center py-8 hidden">
                        <div class="text-6xl mb-4">üîç</div>
                        <h3 class="text-xl font-bold text-gray-600 mb-2">Anggota Tidak Ditemukan</h3>
                        <p class="text-gray-500">Silakan periksa kembali nama atau NIM yang Anda masukkan.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-dashboard" class="container mx-auto px-4 py-8 hidden">
            <div class="mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Dashboard Admin</h2>
                    <button onclick="logout()"
                        class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-all duration-300">
                        üö™ Logout
                    </button>
                </div>

                <!-- Statistics Cards -->
                <div class="grid md:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card text-white p-6 rounded-2xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Total Anggota</p>
                                <p class="text-3xl font-bold" id="totalMembers">0</p>
                            </div>
                            <div class="text-4xl">üë•</div>
                        </div>
                    </div>
                    <div class="bg-orange-500 text-white p-6 rounded-2xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Fakultas</p>
                                <p class="text-3xl font-bold" id="activeFaculties">0</p>
                            </div>
                            <div class="text-4xl">üè´</div>
                        </div>
                    </div>
                    <div class="bg-green-500 text-white p-6 rounded-2xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Prodi Terbanyak</p>
                                <p class="text-lg font-bold" id="topProdi">-</p>
                            </div>
                            <div class="text-4xl">üìö</div>
                        </div>
                    </div>
                    <div class="bg-blue-500 text-white p-6 rounded-2xl shadow-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-white opacity-80">Kampus Terbanyak</p>
                                <p class="text-lg font-bold" id="topCampus">-</p>
                            </div>
                            <div class="text-4xl">üèõÔ∏è</div>
                        </div>
                    </div>
                </div>

                <!-- Search and Export Section -->
                <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üîç Pencarian & Export Data</h3>

                    <!-- Search Filters -->
                    <div class="grid md:grid-cols-3 gap-4 mb-4">
                        <div class="md:col-span-2">
                            <label for="searchAll" class="block text-sm font-medium text-gray-700 mb-2">Cari berdasarkan
                                NIM, Fakultas, atau Program Studi</label>
                            <input type="text" id="searchAll"
                                placeholder="Masukkan NIM, Fakultas, atau Program Studi..."
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div class="flex items-end">
                            <button onclick="resetSearch()"
                                class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-all duration-300">
                                üîÑ Reset
                            </button>
                        </div>
                    </div>

                    <!-- Export Buttons -->
                    <div class="flex flex-wrap gap-3">
                        <button onclick="exportToExcel()"
                            class="bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 transition-all duration-300 font-semibold">
                            üìä Export Excel
                        </button>
                        <button onclick="exportToPDF()"
                            class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700 transition-all duration-300 font-semibold">
                            üìÑ Export PDF
                        </button>
                        <div class="ml-auto">
                            <span class="text-sm text-gray-600">Total hasil: <span id="searchResultCount"
                                    class="font-bold">0</span> anggota</span>
                        </div>
                    </div>
                </div>

                <!-- Members Table -->
                <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-xl font-bold text-gray-800">Daftar Anggota</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Nama</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        NIM</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Fakultas</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Angkatan</th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="membersTable" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="successModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 success-animation">
                <div class="text-center">
                    <div class="text-6xl mb-4">üéâ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Pendaftaran Berhasil!</h3>
                    <p class="text-gray-600 mb-6">Selamat datang di keluarga besar IMM. Data Anda telah tersimpan dan
                        kartu peserta siap diunduh.</p>
                    <div class="space-y-3">
                        <button onclick="downloadRegisteredMemberCard()"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-8 py-3 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 font-semibold">
                            üì• Download Kartu Peserta
                        </button>
                        <button onclick="closeModal()"
                            class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-blue-600 transition-all duration-300 font-semibold">
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let members = JSON.parse(localStorage.getItem('immMembers')) || [];
        let filteredMembers = [];
        let currentPage = 'registration';
        let currentPhoto = null;
        let lastRegisteredMember = null;
        let selectedMemberForPrint = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            showPage('registration');

            // Photo upload handler for registration form
            document.getElementById('foto').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        showMessage('Ukuran file terlalu besar! Maksimal 2MB.', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        currentPhoto = e.target.result;
                        const preview = document.getElementById('photoPreview');
                        preview.innerHTML = `<img src="${currentPhoto}" class="w-full h-full object-cover rounded-lg">`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Search functionality event listeners
            document.getElementById('searchAll').addEventListener('input', performSearch);
        });

        // Page navigation
        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('[id$="-page"], #admin-dashboard').forEach(el => {
                el.classList.add('hidden');
            });

            // Show selected page
            if (page === 'admin-dashboard') {
                document.getElementById('admin-dashboard').classList.remove('hidden');
                loadDashboard();
            } else {
                document.getElementById(page + '-page').classList.remove('hidden');
            }

            // Update navigation buttons
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('bg-white', 'text-purple-700');
                btn.classList.add('bg-purple-800', 'text-white');
            });

            if (page === 'registration') {
                document.getElementById('regBtn').classList.add('bg-white', 'text-purple-700');
                document.getElementById('regBtn').classList.remove('bg-purple-800', 'text-white');
            } else if (page === 'print-card') {
                document.getElementById('printBtn').classList.add('bg-white', 'text-purple-700');
                document.getElementById('printBtn').classList.remove('bg-purple-800', 'text-white');
            } else if (page === 'admin-login') {
                document.getElementById('adminBtn').classList.add('bg-white', 'text-purple-700');
                document.getElementById('adminBtn').classList.remove('bg-purple-800', 'text-white');
            }

            currentPage = page;
        }

        // Registration form
        document.getElementById('registrationForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const memberData = {
                id: Date.now(),
                nama: formData.get('nama'),
                nim: formData.get('nim'),
                fakultas: formData.get('fakultas'),
                prodi: formData.get('prodi'),
                angkatan: formData.get('angkatan'),
                email: formData.get('email'),
                telepon: formData.get('telepon'),
                alamat: formData.get('alamat'),
                motivasi: formData.get('motivasi'),
                tanggalDaftar: new Date().toLocaleDateString('id-ID'),
                noAnggota: generateMemberNumber(),
                foto: currentPhoto
            };

            members.push(memberData);
            localStorage.setItem('immMembers', JSON.stringify(members));

            // Save last registered member for download
            lastRegisteredMember = memberData;

            // Automatically generate and download card PDF
            setTimeout(() => {
                generateCardPDF(memberData);
                showMessage(`üéâ Pendaftaran berhasil! Kartu peserta ${memberData.nama} sedang didownload...`, 'success');
            }, 500);

            // Show success modal
            document.getElementById('successModal').classList.remove('hidden');

            // Reset form
            this.reset();
            currentPhoto = null;
            document.getElementById('photoPreview').innerHTML = `
                <svg width="40" height="40" fill="gray" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
            `;

        });

        // Admin login
        document.getElementById('adminLoginForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;

            if (username === 'admin' && password === 'imm2024') {
                showPage('admin-dashboard');
            } else {
                // Create inline error message instead of alert
                let errorMsg = document.getElementById('loginError');
                if (!errorMsg) {
                    errorMsg = document.createElement('div');
                    errorMsg.id = 'loginError';
                    errorMsg.className = 'mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                    this.appendChild(errorMsg);
                }
                errorMsg.textContent = 'Username atau password salah!';

                setTimeout(() => {
                    if (errorMsg) errorMsg.remove();
                }, 3000);
            }
        });

        // Generate member number
        function generateMemberNumber() {
            const year = new Date().getFullYear();
            const memberCount = members.length + 1;
            return `IMM${year}${memberCount.toString().padStart(4, '0')}`;
        }

        // Load dashboard
        function loadDashboard() {
            // Update statistics
            document.getElementById('totalMembers').textContent = members.length;

            const faculties = [...new Set(members.map(m => m.fakultas))];
            document.getElementById('activeFaculties').textContent = faculties.length;

            // Calculate top program studi
            const prodiCount = {};
            members.forEach(member => {
                prodiCount[member.prodi] = (prodiCount[member.prodi] || 0) + 1;
            });

            const topProdi = Object.keys(prodiCount).reduce((a, b) =>
                prodiCount[a] > prodiCount[b] ? a : b, '-'
            );

            document.getElementById('topProdi').textContent = members.length > 0 ? topProdi : '-';

            // Calculate top campus (fakultas)
            const campusCount = {};
            members.forEach(member => {
                campusCount[member.fakultas] = (campusCount[member.fakultas] || 0) + 1;
            });

            const topCampus = Object.keys(campusCount).reduce((a, b) =>
                campusCount[a] > campusCount[b] ? a : b, '-'
            );

            document.getElementById('topCampus').textContent = members.length > 0 ? topCampus : '-';

            // Initialize filtered members
            filteredMembers = [...members];

            // Load members table
            loadMembersTable();
        }

        // Load members table with current filtered data
        function loadMembersTable() {
            const tbody = document.getElementById('membersTable');
            tbody.innerHTML = '';

            // Update search result count
            document.getElementById('searchResultCount').textContent = filteredMembers.length;

            filteredMembers.forEach(member => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member.nama}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.nim}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.fakultas}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${member.angkatan}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewMember(${member.id})" class="text-blue-600 hover:text-blue-900 mr-3">üëÅÔ∏è Lihat</button>
                        <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-900">üóëÔ∏è Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Show message if no results
            if (filteredMembers.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                        <div class="text-4xl mb-2">üîç</div>
                        <div>Tidak ada data yang ditemukan</div>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // View member details
        function viewMember(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                // Create modal for member details instead of alert
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-2xl mx-4 max-h-96 overflow-y-auto">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Detail Anggota</h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><strong>Nama:</strong> ${member.nama}</div>
                            <div><strong>NIM:</strong> ${member.nim}</div>
                            <div><strong>Fakultas:</strong> ${member.fakultas}</div>
                            <div><strong>Program Studi:</strong> ${member.prodi}</div>
                            <div><strong>Angkatan:</strong> ${member.angkatan}</div>
                            <div><strong>Email:</strong> ${member.email}</div>
                            <div><strong>Telepon:</strong> ${member.telepon}</div>
                            <div><strong>No. Anggota:</strong> ${member.noAnggota}</div>
                            <div class="col-span-2"><strong>Alamat:</strong> ${member.alamat}</div>
                            <div class="col-span-2"><strong>Motivasi:</strong> ${member.motivasi}</div>
                            <div class="col-span-2"><strong>Tanggal Daftar:</strong> ${member.tanggalDaftar}</div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-all duration-300">
                            Tutup
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        // Delete member
        function deleteMember(id) {
            // Create confirmation modal instead of confirm()
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Konfirmasi Hapus</h3>
                    <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus anggota ini?</p>
                    <div class="flex space-x-4">
                        <button onclick="confirmDelete(${id}); this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-all duration-300">
                            Ya, Hapus
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all duration-300">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmDelete(id) {
            members = members.filter(m => m.id !== id);
            localStorage.setItem('immMembers', JSON.stringify(members));
            loadDashboard();
            performSearch(); // Refresh search results
        }

        // Logout
        function logout() {
            showPage('registration');
        }

        // Close modal
        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }

        // Download card for registered member
        function downloadRegisteredMemberCard() {
            if (lastRegisteredMember) {
                generateCardPDF(lastRegisteredMember);
                showMessage('Kartu peserta berhasil diunduh!', 'success');
            }
        }

        // Show message function
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
                }`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Generate PDF card
        function generateCardPDF(memberData) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: [85.6, 53.98] // Credit card size
            });

            // Background gradient (simulated with rectangles)
            doc.setFillColor(220, 38, 38); // Red
            doc.rect(0, 0, 85.6, 53.98, 'F');

            doc.setFillColor(153, 27, 27); // Darker red
            doc.rect(0, 0, 85.6, 15, 'F');

            // Header text
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.setFont(undefined, 'bold');
            doc.text('KARTU PESERTA CALON KADER BARU', 42.8, 8, { align: 'center' });

            doc.setFontSize(6);
            doc.text('IKATAN MAHASISWA MUHAMMADIYAH', 42.8, 12, { align: 'center' });

            // Photo or Logo
            doc.setFillColor(200, 200, 200);
            doc.rect(5, 18, 15, 20, 'F');

            // Check if member has photo
            if (memberData.foto) {
                try {
                    doc.addImage(memberData.foto, 'JPEG', 5, 18, 15, 20);
                } catch (e) {
                    // If image fails, show FOTO placeholder
                    doc.setTextColor(100, 100, 100);
                    doc.setFontSize(5);
                    doc.text('FOTO', 12.5, 28, { align: 'center' });
                }
            } else {
                doc.setTextColor(100, 100, 100);
                doc.setFontSize(5);
                doc.text('FOTO', 12.5, 28, { align: 'center' });
            }

            // Member information
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(7);
            doc.setFont(undefined, 'normal');

            let yPos = 22;
            const lineHeight = 3.5;

            doc.setFont(undefined, 'bold');
            doc.text(memberData.nama || '-', 25, yPos);
            yPos += lineHeight;

            doc.setFont(undefined, 'normal');
            doc.setFontSize(6);
            doc.text(`NIM: ${memberData.nim || '-'}`, 25, yPos);
            yPos += lineHeight;

            doc.text(`Fakultas: ${memberData.fakultas || '-'}`, 25, yPos);
            yPos += lineHeight;

            doc.text(`Prodi: ${memberData.prodi || '-'}`, 25, yPos);
            yPos += lineHeight;

            // Bottom info
            doc.setFontSize(5);
            doc.text(`No. Anggota: ${memberData.noAnggota || '-'}`, 5, 48);
            doc.text(`Angkatan: ${memberData.angkatan || '-'}`, 60, 48);

            // Save PDF
            const fileName = `kartu-peserta-imm-${memberData.nim || 'member'}.pdf`;
            doc.save(fileName);
        }

        // Search functionality
        function performSearch() {
            const searchTerm = document.getElementById('searchAll').value.toLowerCase();

            filteredMembers = members.filter(member => {
                if (!searchTerm) return true;

                return member.nim.toLowerCase().includes(searchTerm) ||
                    member.fakultas.toLowerCase().includes(searchTerm) ||
                    member.prodi.toLowerCase().includes(searchTerm) ||
                    member.nama.toLowerCase().includes(searchTerm);
            });

            loadMembersTable();
        }

        // Reset search
        function resetSearch() {
            document.getElementById('searchAll').value = '';
            filteredMembers = [...members];
            loadMembersTable();
        }

        // Export to Excel
        function exportToExcel() {
            if (filteredMembers.length === 0) {
                showMessage('Tidak ada data untuk diekspor!', 'error');
                return;
            }

            const headers = ['No', 'Nama', 'NIM', 'Fakultas', 'Program Studi', 'Angkatan', 'Email', 'Telepon', 'Alamat', 'No. Anggota', 'Tanggal Daftar'];
            const csvContent = [
                headers.join(','),
                ...filteredMembers.map((member, index) => [
                    index + 1,
                    `"${member.nama}"`,
                    member.nim,
                    `"${member.fakultas}"`,
                    `"${member.prodi}"`,
                    member.angkatan,
                    member.email,
                    member.telepon,
                    `"${member.alamat.replace(/"/g, '""')}"`,
                    member.noAnggota,
                    member.tanggalDaftar
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `data-anggota-imm-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();

            showMessage('Data berhasil diekspor ke Excel!', 'success');
        }

        // Export to PDF
        function exportToPDF() {
            if (filteredMembers.length === 0) {
                showMessage('Tidak ada data untuk diekspor!', 'error');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('DAFTAR ANGGOTA IMM', 105, 20, { align: 'center' });

            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`Tanggal Export: ${new Date().toLocaleDateString('id-ID')}`, 20, 35);
            doc.text(`Total Anggota: ${filteredMembers.length}`, 20, 45);

            // Table headers
            let yPos = 60;
            const lineHeight = 8;

            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            doc.text('No', 20, yPos);
            doc.text('Nama', 35, yPos);
            doc.text('NIM', 80, yPos);
            doc.text('Fakultas', 110, yPos);
            doc.text('Angkatan', 160, yPos);
            doc.text('No. Anggota', 180, yPos);

            // Draw line under header
            doc.line(20, yPos + 2, 200, yPos + 2);
            yPos += 10;

            // Table data
            doc.setFont(undefined, 'normal');
            filteredMembers.forEach((member, index) => {
                if (yPos > 270) { // New page if needed
                    doc.addPage();
                    yPos = 20;
                }

                doc.text((index + 1).toString(), 20, yPos);
                doc.text(member.nama.substring(0, 20), 35, yPos);
                doc.text(member.nim, 80, yPos);
                doc.text(member.fakultas.substring(0, 15), 110, yPos);
                doc.text(member.angkatan.toString(), 160, yPos);
                doc.text(member.noAnggota, 180, yPos);

                yPos += lineHeight;
            });

            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.text(`Halaman ${i} dari ${pageCount}`, 105, 290, { align: 'center' });
            }

            doc.save(`daftar-anggota-imm-${new Date().toISOString().split('T')[0]}.pdf`);
            showMessage('Data berhasil diekspor ke PDF!', 'success');
        }

        // Print Card Functions
        function searchForPrint() {
            const searchTerm = document.getElementById('searchMember').value.toLowerCase().trim();

            if (!searchTerm) {
                showMessage('Silakan masukkan nama atau NIM untuk mencari!', 'error');
                return;
            }

            const results = members.filter(member =>
                member.nama.toLowerCase().includes(searchTerm) ||
                member.nim.toLowerCase().includes(searchTerm)
            );

            const searchResults = document.getElementById('searchResults');
            const membersList = document.getElementById('membersList');
            const noResults = document.getElementById('noResults');
            const cardPreview = document.getElementById('cardPreview');

            // Hide card preview
            cardPreview.classList.add('hidden');

            if (results.length > 0) {
                // Show results
                searchResults.classList.remove('hidden');
                noResults.classList.add('hidden');

                membersList.innerHTML = '';
                results.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.className = 'bg-gray-50 p-4 rounded-lg border hover:bg-gray-100 cursor-pointer transition-all duration-300';
                    memberDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="font-semibold text-gray-800">${member.nama}</h4>
                                <p class="text-sm text-gray-600">NIM: ${member.nim} | ${member.fakultas} | ${member.prodi}</p>
                                <p class="text-sm text-gray-500">No. Anggota: ${member.noAnggota}</p>
                            </div>
                            <button onclick="selectMemberForPrint(${member.id})" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-300">
                                Pilih
                            </button>
                        </div>
                    `;
                    membersList.appendChild(memberDiv);
                });
            } else {
                // Show no results
                searchResults.classList.add('hidden');
                noResults.classList.remove('hidden');
            }
        }

        function selectMemberForPrint(memberId) {
            const member = members.find(m => m.id === memberId);
            if (!member) return;

            selectedMemberForPrint = member;

            // Hide search results
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('noResults').classList.add('hidden');

            // Show card preview
            const cardPreview = document.getElementById('cardPreview');
            const memberCard = document.getElementById('memberCard');

            // Generate card HTML
            memberCard.innerHTML = `
                <div class="absolute top-0 left-0 right-0 h-15 bg-gradient-to-r from-red-400 to-red-600 flex items-center justify-center">
                    <div class="text-white text-center">
                        <div class="text-xs font-bold">KARTU PESERTA CALON KADER BARU</div>
                        <div class="text-xs opacity-90">IKATAN MAHASISWA MUHAMMADIYAH</div>
                    </div>
                </div>
                
                <div class="absolute top-16 left-4 w-16 h-20 bg-gray-200 rounded border-2 border-white overflow-hidden">
                    ${member.foto ?
                    `<img src="${member.foto}" class="w-full h-full object-cover">` :
                    `<div class="w-full h-full flex items-center justify-center text-xs text-gray-500">FOTO</div>`
                }
                </div>
                
                <div class="absolute top-16 left-24 right-4 text-white">
                    <div class="font-bold text-sm mb-1">${member.nama}</div>
                    <div class="text-xs opacity-90 mb-1">NIM: ${member.nim}</div>
                    <div class="text-xs opacity-90 mb-1">Fakultas: ${member.fakultas}</div>
                    <div class="text-xs opacity-90">Prodi: ${member.prodi}</div>
                </div>
                
                <div class="absolute bottom-2 left-4 right-4 flex justify-between text-white text-xs">
                    <span>No: ${member.noAnggota}</span>
                    <span>Angkatan: ${member.angkatan}</span>
                </div>
            `;



            cardPreview.classList.remove('hidden');
        }

        function printCard() {
            if (!selectedMemberForPrint) return;

            window.print();
        }

        function downloadCardPDF() {
            if (!selectedMemberForPrint) return;

            generateCardPDF(selectedMemberForPrint);
            showMessage('Kartu peserta berhasil didownload!', 'success');
        }
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9910faa7f3dffdbb',t:'MTc2MDg4NDI5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>